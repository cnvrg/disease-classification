# InfluxDB Connector (Library)
The InfluxDB Connector is a library that utilizes the InfluxDB API to pull time-series data, store it in CSV format, and feed it as input to existing model training, inference, and batch predict blueprints. An InfluxDB account, its user credentials, and its user API access token are required to use this connector library.

Click [here](https://github.com/cnvrg/data-connectors/tree/influxdb_connector) for more information on this connector.

## Connector Flow
The following list provides this connector's high-level flow:
- The user defines inputs such as `token`, `url`, and `org` in cnvrg Projects > Settings > Secrets or provides them as arguments. Refer to the [Run Instructions](#run-instructions) later in this document.
- The user accesses the InfluxDB API.
- The InfluxDB connector (with the API token, client URL, and organization email passed as cnvrg Secrets) provides the time-series data and stores it in CSV format.

## Inputs
This library assumes the user has an existing InfluxDB account. The user's credentials and InfluxDB API token are required as input, which can be obtained from the user's InfluxDB account.

The InfluxDB Connector requires the following inputs:
- `--token` - string, required. API access token for your InfluxDB workspace. For security reasons, we recommend creating/updating the Cnvrg Secret `INFLUXDB_TOKEN` under Project->Settings->Secrets to store the InfluxDB API token. Enter the value ‘Secret’ if the Cnvrg Secret has been created/updated; otherwise enter the actual API token.
- `--url` - string, required. Client url for your InfluxDB workspace. For security reasons, we recommend creating/updating the Cnvrg Secret `INFLUXDB_URL` under Project->Settings->Secrets to store the InfluxDB Client ID. Enter the value ‘Secret’ if the Cnvrg Secret has been created/updated; otherwise enter the actual Client ID.
- `--org` - string, required. Organization email for your InfluxDB workspace. For security reasons, we recommend creating/updating the Cnvrg Secret `INFLUXDB_ORG` under Project->Settings->Secrets to store the InfluxDB Client ID. Enter the value ‘Secret’ if the Cnvrg Secret has been created/updated; otherwise enter the actual Client ID.
- `--bucket` - string, required. Data bucket to pull data from. This can also be stored as Cnvrg Secret `INFLUXDB_BUCKET` under Project->Settings->Secrets to store the InfluxDB Client ID. Enter the value ‘Secret’ if the Cnvrg Secret has been created/updated; otherwise enter the actual Client ID.
- `--measurement` - string, required. Data measurement to pull data from. 
- `--time_col` - string, required. Name of the time column. 
- `--range_start` - string, optional. Fetch from starting date in the format of 2020-01-01T00:00:00Z, or specify -1y -1d, -1h, -1m for year, day, hour, or minute. For detailed query language, refer to [Influxdb Doc](https://docs.influxdata.com/influxdb/cloud/query-data/flux/Default)
- `--range_end` - string, optional. Fetch from starting date in the format of 2020-01-01T00:00:00Z, or now() for current datetime. For detailed query language, refer to [Influxdb Doc](https://docs.influxdata.com/influxdb/cloud/query-data/flux/Default)
- `--cnvrg_dataset` - string, optional. Name of the cnvrg dataset to store the csv file. Default value - ‘None’
- `--file_name` - string, optional. Name of the csv file to be generated. Default value - influxdb.csv’

## Run Instructions
Refer to the following sample command to run this connector code:

```
python influxdb_connector.py --token <TOKEN> --url <URL> --org <ORG> --bucket <BUCKET> --measurement <MEASUREMENT> --time_col <TIMECOL>
```

## Outputs
The InfluxDB Connector library generates the following outputs:
- The connector library outputs the user-configured InfluxDB data in a CSV-formatted file by default called `influxdb.csv`.
- The library writes all files created to the default path `/cnvrg`.
- The user (optionally) stores the output CSV file in a new or existing cnvrg dataset.

## Troubleshooting
Complete one or more of the following steps to troubleshoot issues that may be encountered with this connector:
- Confirm the `token`, `url`, and `org` are valid.
- Check the Experiments > Artifacts section to confirm output CSV files have been generated by this connector.
- Check the job status, which cnvrg displays simultaneously for each task completed: when the data is pulled and when the job is completed.
- Check for an error message, which displays if the experiment fails. If so, cnvrg goes into Debug mode, which allows limited time to check the logs in the Experiments tab to resolve the problem.

## Related Blueprint Models
The InfluxDB Connector can be used with the following blueprints:
- [Anomaly Detection Time-Series Train](https://metacloud.staging-cloud.cnvrg.io/marketplace/blueprints/adts-training)
- [Anomaly Detection Time-Series Inference](https://metacloud.staging-cloud.cnvrg.io/marketplace/blueprints/adts-inference)
- [Sensor Forecasting Time-Series Train](link)
- [Sensor Forecasting Time-Series Inference](link)
- [Remaining Useful Life Train](link)
- [Remaining Useful Life Inference](link)
